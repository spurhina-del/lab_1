<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Лабораторна робота – коефіцієнт корисності</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
body { font-family: 'Inter', sans-serif; }
</style>
</head>

<body class="bg-slate-50 min-h-screen pb-12">

<div class="max-w-6xl mx-auto px-4 mt-8">

<header class="bg-indigo-900 rounded-3xl p-8 text-white shadow-xl mb-8">
    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
        <div>
            <h1 class="text-xl font-black uppercase">Лабораторна робота</h1>
            <p class="text-indigo-300 text-sm">Розрахунок коефіцієнтів ефективності</p>
        </div>
        <div class="flex gap-4">
            <input id="studentName" type="text"
                placeholder="Прізвище та імʼя"
                class="bg-transparent border-b border-indigo-400 outline-none text-white font-bold">
            <select id="variantSelect" onchange="render()"
                class="bg-indigo-950 rounded-lg px-3 py-1 font-bold">
                <option value="">Варіант</option>
                <option value="1">1</option><option value="2">2</option>
                <option value="3">3</option><option value="4">4</option>
                <option value="5">5</option><option value="6">6</option>
                <option value="7">7</option><option value="8">8</option>
                <option value="9">9</option><option value="10">10</option>
            </select>
        </div>
    </div>
</header>

<main class="grid gap-8">

<section class="bg-white p-6 rounded-3xl border shadow">
    <h2 id="variantGoal" class="text-xl font-bold"></h2>
    <p id="variantDesc" class="text-slate-500 mt-2"></p>
    <p class="mt-4 font-mono text-indigo-700" id="variantFormulaTech"></p>
</section>

<section class="bg-white rounded-3xl border shadow overflow-x-auto">
<table class="w-full">
<thead id="tableHeader" class="bg-slate-100 text-xs uppercase"></thead>
<tbody id="tableBody"></tbody>
</table>
</section>

<section class="grid md:grid-cols-2 gap-6">
    <div class="bg-white p-4 rounded-3xl border shadow h-[350px]">
        <canvas id="techChart"></canvas>
    </div>
    <div class="bg-white p-4 rounded-3xl border shadow h-[350px]">
        <canvas id="econChart"></canvas>
    </div>
</section>

<section class="bg-white p-6 rounded-3xl border shadow">
<textarea id="conclusion" placeholder="Висновок..."
class="w-full p-4 border rounded-xl h-40"></textarea>
</section>

<section class="text-center">
<button onclick="generatePersonalLink()"
class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-xl">
Зберегти як персональний лінк
</button>
</section>

</main>
</div>

<script>
const MATERIALS = {
"Сталь 45":{sigma_v:650,rho:7850,E:210},
"Алюміній Д16Т":{sigma_v:450,rho:2780,E:72},
"Карбон":{sigma_v:1200,rho:1600,E:150},
"Титан ВТ6":{sigma_v:950,rho:4420,E:115}
};

const VARIANTS = {
"1":{goal:"Рама велосипеда",materials:["Сталь 45","Алюміній Д16Т","Карбон"],formula:"σв/ρ",desc:"Питома міцність"},
"2":{goal:"Корпус пристрою",materials:["Алюміній Д16Т","Карбон","Титан ВТ6"],formula:"σв/(ρE)",desc:"Міцність і жорсткість"}
};

let techChart, econChart;

function render() {
const vId=document.getElementById("variantSelect").value;
if(!VARIANTS[vId]) return;
const v=VARIANTS[vId];

variantGoal.innerText=v.goal;
variantDesc.innerText=v.desc;
variantFormulaTech.innerText="Kтех = "+v.formula;

tableHeader.innerHTML="<tr><th>Параметр</th>"+v.materials.map(m=>`<th>${m}</th>`).join("")+"</tr>";
tableBody.innerHTML="";

["sigma_v","rho","E"].forEach(p=>{
tableBody.innerHTML+=`<tr><td>${p}</td>`+
v.materials.map(m=>`<td>${MATERIALS[m][p]}</td>`).join("")+"</tr>";
});

["k_tech","k_econ"].forEach(t=>{
tableBody.innerHTML+=`<tr><td>${t}</td>`+
v.materials.map((_,i)=>`<td><input class="calc-input" data-type="${t}" data-idx="${i}"></td>`).join("")+"</tr>";
});

setupCharts(v.materials);
restoreFromLink();
}

function setupCharts(labels){
if(techChart) techChart.destroy();
if(econChart) econChart.destroy();
techChart=new Chart(techChartEl,{type:"bar",data:{labels,datasets:[{data:[]}]}})
econChart=new Chart(econChartEl,{type:"bar",data:{labels,datasets:[{data:[]}]}})
}

function updateCharts(){
const get=t=>[...document.querySelectorAll(`[data-type="${t}"]`)].map(i=>+i.value||0);
techChart.data.datasets[0].data=get("k_tech");
econChart.data.datasets[0].data=get("k_econ");
techChart.update(); econChart.update();
}

document.addEventListener("input",e=>{
if(e.target.classList.contains("calc-input")) updateCharts();
});

function generatePersonalLink(){
const p=new URLSearchParams();
p.set("student",studentName.value);
p.set("variant",variantSelect.value);
p.set("conclusion",conclusion.value);
document.querySelectorAll(".calc-input").forEach(i=>{
p.set(`${i.dataset.type}_${i.dataset.idx}`,i.value);
});
prompt("Скопіюйте лінк:",location.origin+location.pathname+"?"+p);
}

function restoreFromLink(){
const p=new URLSearchParams(location.search);
if(p.get("variant")){variantSelect.value=p.get("variant");}
studentName.value=p.get("student")||"";
conclusion.value=p.get("conclusion")||"";
setTimeout(()=>{
document.querySelectorAll(".calc-input").forEach(i=>{
const k=`${i.dataset.type}_${i.dataset.idx}`;
if(p.get(k)) i.value=p.get(k);
});
updateCharts();
},0);
}

window.onload=render;
</script>

</body>
</html>
